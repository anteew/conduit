{
  "ampcode": "v1",
  "waves": [
    { "id": "Wave-HTTP-Multipart-Blob", "parallel": true, "tasks": [
      "T5010-Multipart-Streaming-Form",
      "T5011-Blob-SideChannel",
      "T5012-BlobRef-Enqueue",
      "T5013-Integrity-Metadata"
    ]},
    { "id": "Wave-HTTP-Policy", "parallel": true, "tasks": [
      "T5020-Large-Detection-Threshold",
      "T5021-JSON-Cap-Gzip",
      "T5022-CORS-Preflight",
      "T5023-Auth-Tokens-OIDC"
    ]},
    { "id": "Wave-HTTP-Limits", "parallel": true, "tasks": [
      "T5030-RateLimits-Quota",
      "T5031-Concurrency-Caps",
      "T5032-Timeouts-KeepAlive",
      "T5033-Header-Size-Limits"
    ]},
    { "id": "Wave-Observability", "parallel": true, "tasks": [
      "T5040-HTTP-JSONL-Logs",
      "T5041-WS-JSONL-Logs",
      "T5042-Metrics-Expand",
      "T5043-Record-Replay-Edge"
    ]},
    { "id": "Wave-WS-Hardening", "parallel": true, "tasks": [
      "T5050-WS-Size-Caps",
      "T5051-WS-Rate-Limits",
      "T5052-WS-Backpressure-Strict",
      "T5053-WS-StickySessions"
    ]},
    { "id": "Wave-Reload-Tenancy", "parallel": true, "tasks": [
      "T5060-ZeroDowntime-Reload",
      "T5061-Tenant-Partitioning",
      "T5062-PerTenant-Overlays"
    ]},
    { "id": "Wave-Load-Soak", "parallel": true, "tasks": [
      "T5070-Concurrent-Uploads-100",
      "T5071-Concurrent-WS-100",
      "T5072-Soak-1h-Mixed",
      "T5073-SRE-Runbook-Update"
    ]},
    { "id": "Wave-UX-Docs", "parallel": true, "tasks": [
      "T5080-HTTP-UX-Final",
      "T5081-WS-UX-Final",
      "T5082-UI-Multipart-Form",
      "T5083-UI-Perf-Panel"
    ]},
    { "id": "Wave-Exploration", "parallel": false, "tasks": [
      "T5090-HTTP2-HTTP3-Exploration",
      "T5091-Resumable-Uploads",
      "T5092-Codec-CBOR"
    ]}
  ],
  "tasks": [
    {"id":"T5010-Multipart-Streaming-Form","agent":"gemini","title":"HTTP multipart/form-data streaming upload","why":"Browser form uploads should stream without buffering","allowedFiles":["src/connectors/http.ts","package.json","README.md","docs/rfcs/GATEWAY-HTTP-UX.md","public/index.html","public/ui.js"],"verify":["npm run test:compile"],"deliverables":["Stream first file part to sink; preserve async/sync; progress logs + MB/s; safe limits (size, parts, fields)"]},
    {"id":"T5011-Blob-SideChannel","agent":"gemini","title":"Blob side-channel (S3/MinIO/local)","why":"Persist large uploads and return blobRef","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Pluggable sink (env-driven); returns {blobId, size, sha256, mime}"]},
    {"id":"T5012-BlobRef-Enqueue","agent":"gemini","title":"Enqueue envelope with blobRef","why":"Let cores consume blobs via references","allowedFiles":["src/dsl/*","config/rules.yaml","README.md"],"verify":["npm run test:compile"],"deliverables":["Rule to emit enqueue {env:{blobRef,...}} on upload completion (optional)"]},
    {"id":"T5013-Integrity-Metadata","agent":"gemini","title":"Integrity metadata on uploads","why":"SRE + app validation","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Compute sha256, mime, size; write alongside blob; include in logs"]},

    {"id":"T5020-Large-Detection-Threshold","agent":"gemini","title":"Auto-detect large/binary requests","why":"Route users to upload path by default","allowedFiles":["src/connectors/http.ts","config/rules.yaml","README.md"],"verify":["npm run test:compile"],"deliverables":["Binary MIME allowlist + size threshold; route to upload or reject"]},
    {"id":"T5021-JSON-Cap-Gzip","agent":"gemini","title":"JSON caps + gzip suggestion","why":"Protect memory and latency","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["413 for oversize JSON; doc gzip guidance; header checks"]},
    {"id":"T5022-CORS-Preflight","agent":"gemini","title":"CORS allowlist + OPTIONS preflight","why":"Enable cross-origin clients safely","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Env-driven origins; preflight for /v1/* and /ui"]},
    {"id":"T5023-Auth-Tokens-OIDC","agent":"gemini","title":"Auth tokens (API keys) + OIDC stub","why":"Basic protection now; future-ready","allowedFiles":["src/connectors/http.ts","src/connectors/ws.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Authorization: Bearer/X-Token allowlist; OIDC config stub"]},

    {"id":"T5030-RateLimits-Quota","agent":"gemini","title":"Per-IP/token rate/burst quotas","why":"Fairness and protection under load","allowedFiles":["src/connectors/http.ts","src/connectors/ws.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Token-bucket per endpoint (upload/enqueue/subscribe); env knobs; 429/Retry-After"]},
    {"id":"T5031-Concurrency-Caps","agent":"gemini","title":"Concurrent upload & request caps","why":"Scale to many clients safely","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Per-IP concurrent upload limit; connection caps; graceful rejects"]},
    {"id":"T5032-Timeouts-KeepAlive","agent":"gemini","title":"HTTP keep-alive & timeouts","why":"Resilience and resource safety","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Idle/request timeouts; keep-alive tuning; slowloris protection"]},
    {"id":"T5033-Header-Size-Limits","agent":"gemini","title":"Header size/cookie length limits","why":"Prevent abuse and memory spikes","allowedFiles":["src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Max header size; reject 431 on exceed"]},

    {"id":"T5040-HTTP-JSONL-Logs","agent":"gemini","title":"Structured HTTP JSONL logs","why":"Agent-first observability","allowedFiles":["src/connectors/http.ts","docs/OBSERVABILITY.md","reports/.keep"],"verify":["npm run test:compile"],"deliverables":["reports/gateway-http.log.jsonl: ts,ip,method,path,bytes,mode,ruleId,status,durMs,rateMBps,error"]},
    {"id":"T5041-WS-JSONL-Logs","agent":"gemini","title":"Structured WS JSONL logs","why":"Trace subscribe/credit/deliver","allowedFiles":["src/connectors/ws.ts","docs/OBSERVABILITY.md","reports/.keep"],"verify":["npm run test:compile"],"deliverables":["reports/gateway-ws.log.jsonl: ts,connId,ip,stream,credit,delivers,closeCode,error"]},
    {"id":"T5042-Metrics-Expand","agent":"gemini","title":"Expand metrics with counters/histograms","why":"SRE dashboards & agents","allowedFiles":["src/connectors/http.ts","src/connectors/ws.ts","README.md"],"verify":["curl -sS http://127.0.0.1:9087/v1/metrics || true"],"deliverables":["Add rule hits, bytes in/out, request durations, credit usage"]},
    {"id":"T5043-Record-Replay-Edge","agent":"claude","title":"Record/replay guidance for edge","why":"Repro issues across envs","allowedFiles":["README.md","docs/OBSERVABILITY.md"],"verify":["# Manual: doc exists"],"deliverables":["Instructions for CONDUIT_RECORD and replay pipelines"]},

    {"id":"T5050-WS-Size-Caps","agent":"gemini","title":"WS message size caps","why":"Prevent oversized frames","allowedFiles":["src/connectors/ws.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Cap per-message size; 1009 close on exceed; doc"]},
    {"id":"T5051-WS-Rate-Limits","agent":"gemini","title":"WS per-conn rate limits","why":"Avoid abuse; fairness","allowedFiles":["src/connectors/ws.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Token-bucket per connection; env knobs; errors mapped"]},
    {"id":"T5052-WS-Backpressure-Strict","agent":"gemini","title":"WS delivery backpressure (strict window)","why":"Predictable delivery under load","allowedFiles":["src/connectors/ws.ts","tests/ws_bidir.test.ts"],"verify":["node --loader ts-node/esm tests/ws_bidir.test.ts"],"deliverables":["Exact window behavior; tests for burst/window"]},
    {"id":"T5053-WS-StickySessions","agent":"gemini","title":"Sticky sessions readiness","why":"LB across many edges","allowedFiles":["README.md"],"verify":["# Manual: doc exists"],"deliverables":["Doc/setup guidance for WS behind LB"]},

    {"id":"T5060-ZeroDowntime-Reload","agent":"gemini","title":"Zero-downtime rules/env reload","why":"Change config without dropping clients","allowedFiles":["src/index.ts","src/connectors/http.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["SIGHUP or watch-based reload; graceful drain; health flips"]},
    {"id":"T5061-Tenant-Partitioning","agent":"gemini","title":"Multi-tenant partitioning","why":"Limits and isolation per tenant","allowedFiles":["src/connectors/http.ts","src/connectors/ws.ts","README.md"],"verify":["npm run test:compile"],"deliverables":["Tokenâ†’tenant mapping; per-tenant limits; per-tenant metrics tags"]},
    {"id":"T5062-PerTenant-Overlays","agent":"claude","title":"Per-tenant rule overlays","why":"Custom endpoints without forking","allowedFiles":["config/rules.yaml","docs/RULES-REFERENCE.md"],"verify":["# Manual: rule overlay example present"],"deliverables":["Documented overlay mechanism and example"]},

    {"id":"T5070-Concurrent-Uploads-100","agent":"gemini","title":"Concurrent uploads load test (100 clients)","why":"Validate throughput and memory","allowedFiles":["tests/concurrent_uploads.test.ts","package.json"],"verify":["npm run test:compile && node tests_compiled/concurrent_uploads.test.js || true"],"deliverables":["Report: throughput, errors, memory footprint"]},
    {"id":"T5071-Concurrent-WS-100","agent":"gemini","title":"Concurrent WS clients load test (100)","why":"Validate WS scalability","allowedFiles":["tests/concurrent_ws.test.ts","package.json"],"verify":["npm run test:compile && node tests_compiled/concurrent_ws.test.js || true"],"deliverables":["Report: connects/sec, deliveries, memory"]},
    {"id":"T5072-Soak-1h-Mixed","agent":"gemini","title":"1-hour soak test (HTTP+WS)","why":"Surface leaks/flakes over time","allowedFiles":["tests/soak_mixed.test.ts","README.md"],"verify":["node --loader ts-node/esm tests/soak_mixed.test.ts || true"],"deliverables":["Summary table + follow-ups"]},
    {"id":"T5073-SRE-Runbook-Update","agent":"claude","title":"Gateway SRE runbook","why":"Ops guidance for incidents","allowedFiles":["docs/SRE-RUNBOOK.md"],"verify":["test -f docs/SRE-RUNBOOK.md"],"deliverables":["Runbook: checks, logs, metrics, knobs"]},

    {"id":"T5080-HTTP-UX-Final","agent":"claude","title":"Finalize HTTP UX RFC with examples","why":"Set expectations and defaults","allowedFiles":["docs/rfcs/GATEWAY-HTTP-UX.md","README.md"],"verify":["rg -n 'multipart' docs/rfcs/GATEWAY-HTTP-UX.md"],"deliverables":["RFC updated with multipart + examples and defaults"]},
    {"id":"T5081-WS-UX-Final","agent":"claude","title":"Finalize WS UX RFC","why":"Set developer expectations","allowedFiles":["docs/rfcs/GATEWAY-WS-UX.md","README.md"],"verify":["rg -n 'close codes' docs/rfcs/GATEWAY-WS-UX.md"],"deliverables":["RFC updated with size/rate/credit semantics"]},
    {"id":"T5082-UI-Multipart-Form","agent":"claude","title":"Add HTML form to UI for multipart","why":"Browser-native path test","allowedFiles":["public/index.html","public/ui.js"],"verify":["# Manual: open /ui and submit form"]},
    {"id":"T5083-UI-Perf-Panel","agent":"claude","title":"UI perf panel","why":"Show current throughput and latencies","allowedFiles":["public/ui.js","public/index.html"],"verify":["# Manual: dashboard displays recent rates"]},

    {"id":"T5090-HTTP2-HTTP3-Exploration","agent":"gemini","title":"HTTP/2 and HTTP/3 exploration","why":"Future performance & transport options","allowedFiles":["README.md"],"verify":["# Manual: doc exists"],"deliverables":["Notes on feasibility, libs, migration path"]},
    {"id":"T5091-Resumable-Uploads","agent":"gemini","title":"Resumable/chunked uploads design","why":"Robust long-running transfers","allowedFiles":["docs/rfcs/GATEWAY-HTTP-UX.md"],"verify":["rg -n 'resum' docs/rfcs/GATEWAY-HTTP-UX.md"],"deliverables":["Design sketch + phased plan"]},
    {"id":"T5092-Codec-CBOR","agent":"gemini","title":"CBOR/MessagePack codec option","why":"Compact control frames","allowedFiles":["README.md","docs/rfcs/PROTO-DSL-v0.md"],"verify":["# Manual: doc exists"],"deliverables":["Doc on opt-in codec and impacts"]}
  ]
}
